<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Menu QR Pro - Äáº·t MÃ³n</title>
  <style>
    :root { 
        --primary: #d32f2f; 
        --bg: #f8f9fa;
        font-family: 'Segoe UI', Roboto, sans-serif;
    }
    body { margin: 0; background: var(--bg); padding-bottom: 30px; }
    header { background: white; border-bottom: 2px solid var(--primary); padding: 15px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .wrap { max-width: 600px; margin: 0 auto; padding: 0 15px; }
    .topbar { display: flex; justify-content: space-between; align-items: center; }
    .brand { font-size: 20px; font-weight: 800; color: var(--primary); }
    
    .card { background: white; border-radius: 15px; padding: 15px; margin-top: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    h2 { font-size: 16px; margin: 0 0 10px 0; color: #333; }

    /* Menu Items */
    .item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
    .item-name { font-weight: 600; display: block; }
    .item-price { color: var(--primary); font-weight: 700; font-size: 14px; }
    .btn-add { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; }

    /* Cart */
    .cart-summary { background: #fff8f8; padding: 10px; border-radius: 8px; margin-bottom: 10px; min-height: 40px; }
    .cart-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px; }
    textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-sizing: border-box; margin: 10px 0; }
    
    .btn-order { background: #1a1a1a; color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; }
    .btn-order:disabled { background: #ccc; }
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">ğŸ  NHÃ€ HÃ€NG DELI</div>
      <div style="font-size: 14px;">BÃ n: <b id="displayTable">---</b></div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <h2>ğŸ´ Danh sÃ¡ch mÃ³n Äƒn</h2>
    <div id="menuContent"></div>
  </div>

  <div class="card">
    <h2>ğŸ›’ Giá» hÃ ng cá»§a báº¡n</h2>
    <div id="cartList" class="cart-summary">ChÆ°a chá»n mÃ³n nÃ o...</div>
    <div style="text-align: right; font-size: 18px; margin-bottom: 10px;">Tá»•ng cá»™ng: <b id="totalPrice" style="color: var(--primary);">0â‚«</b></div>
    <textarea id="orderNote" rows="2" placeholder="Ghi chÃº: ThÃªm Ä‘Ã¡, Ã­t hÃ nh, khÃ´ng cay..."></textarea>
    <button id="submitBtn" class="btn-order" onclick="sendToTelegram()">XÃC NHáº¬N Äáº¶T MÃ“N</button>
  </div>
</main>

<script>
  // THÃ”NG TIN ÄÃƒ Cáº¬P NHáº¬T CHÃNH XÃC
  const TG_TOKEN = "8428955430:AAEvZ_8fM0yVbw7RiQ2XLuWcud3Bl48Hi48";
  const TG_CHAT_ID = "1533009941";

  const MENU = [
    { id: 1, name: "Phá»Ÿ BÃ² TÃ¡i", price: 45000 },
    { id: 2, name: "Phá»Ÿ GÃ  Ta", price: 45000 },
    { id: 3, name: "BÃºn BÃ² Huáº¿", price: 50000 },
    { id: 4, name: "CÃ  PhÃª Sá»¯a", price: 25000 },
    { id: 5, name: "NÆ°á»›c Cam Ã‰p", price: 30000 }
  ];

  let cart = {};
  const params = new URLSearchParams(location.search);
  const table = params.get("table") || "Mang vá»";
  document.getElementById("displayTable").innerText = table;

  function renderMenu() {
    document.getElementById("menuContent").innerHTML = MENU.map(item => `
      <div class="item">
        <div>
          <span class="item-name">${item.name}</span>
          <span class="item-price">${item.price.toLocaleString()}â‚«</span>
        </div>
        <button class="btn-add" onclick="addToCart(${item.id})">ThÃªm +</button>
      </div>
    `).join("");
  }

  function addToCart(id) {
    cart[id] = (cart[id] || 0) + 1;
    updateCart();
  }

  function updateCart() {
    const list = document.getElementById("cartList");
    let html = "";
    let total = 0;
    const entries = Object.entries(cart);

    if (entries.length === 0) {
      list.innerHTML = "ChÆ°a chá»n mÃ³n nÃ o...";
      document.getElementById("totalPrice").innerText = "0â‚«";
      return;
    }

    entries.forEach(([id, qty]) => {
      const item = MENU.find(m => m.id == id);
      total += item.price * qty;
      html += `<div class="cart-row"><span>${item.name} x${qty}</span><span>${(item.price * qty).toLocaleString()}â‚«</span></div>`;
    });

    list.innerHTML = html;
    document.getElementById("totalPrice").innerText = total.toLocaleString() + "â‚«";
  }

  async function sendToTelegram() {
    if (Object.keys(cart).length === 0) return alert("Vui lÃ²ng chá»n mÃ³n!");

    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.innerText = "ÄANG Gá»¬I ÄÆ N...";

    let text = `ğŸ”” <b>ÄÆ N HÃ€NG Má»šI</b>\n`;
    text += `ğŸ“ <b>BÃ n:</b> ${table}\n`;
    text += `â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    Object.entries(cart).forEach(([id, qty]) => {
      const item = MENU.find(m => m.id == id);
      text += `â€¢ ${item.name} x${qty}\n`;
    });
    text += `â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    text += `ğŸ’° <b>Tá»•ng: ${document.getElementById("totalPrice").innerText}</b>\n`;
    text += `ğŸ“ <b>Ghi chÃº:</b> ${document.getElementById("orderNote").value || "KhÃ´ng"}`;

    try {
      const response = await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: TG_CHAT_ID, text: text, parse_mode: "HTML" })
      });

      const data = await response.json();
      if (data.ok) {
        alert("âœ… ThÃ nh cÃ´ng! ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c gá»­i tá»›i báº¿p.");
        cart = {}; document.getElementById("orderNote").value = ""; updateCart();
      } else {
        alert("âŒ Lá»—i Telegram: " + data.description);
      }
    } catch (e) {
      alert("âŒ Lá»—i káº¿t ná»‘i máº¡ng!");
    } finally {
      btn.disabled = false;
      btn.innerText = "XÃC NHáº¬N Äáº¶T MÃ“N";
    }
  }

  renderMenu();
</script>
</body>
</html>
