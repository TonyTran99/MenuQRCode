<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Menu QR Pro - Äáº·t MÃ³n</title>
  <style>
    :root { 
        --primary: #d32f2f; 
        --bg: #f8f9fa;
        --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
        font-family: 'Segoe UI', Roboto, sans-serif;
    }
    body { margin: 0; background: var(--bg); padding-bottom: 50px; color: #333; }
    header { background: white; border-bottom: 2px solid var(--primary); padding: 15px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .wrap { max-width: 600px; margin: 0 auto; padding: 0 15px; }
    .topbar { display: flex; justify-content: space-between; align-items: center; }
    .brand { font-size: 20px; font-weight: 800; color: var(--primary); }
    
    .card { background: white; border-radius: 15px; padding: 20px; margin-top: 15px; box-shadow: var(--card-shadow); }
    h2 { font-size: 18px; margin: 0 0 15px 0; display: flex; align-items: center; gap: 8px; }

    /* Menu Items */
    .item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
    .item:last-child { border-bottom: none; }
    .item-name { font-weight: 600; display: block; font-size: 16px; margin-bottom: 4px; }
    .item-price { color: var(--primary); font-weight: 700; font-size: 15px; }

    /* Quantity Controls */
    .qty-box { display: flex; align-items: center; gap: 12px; background: #f1f1f1; border-radius: 10px; padding: 4px; }
    .btn-qty { width: 32px; height: 32px; border: none; border-radius: 8px; background: white; cursor: pointer; font-weight: bold; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn-qty:active { transform: scale(0.9); }
    .qty-num { font-weight: 700; min-width: 20px; text-align: center; font-size: 16px; }

    /* Cart Preview */
    .preview-list { background: #fffcfc; border: 1px dashed var(--primary); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
    .preview-item { display: flex; justify-content: space-between; font-size: 15px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
    .preview-item:last-child { border-bottom: none; margin-bottom: 0; }
    
    textarea { width: 100%; border: 1px solid #ddd; border-radius: 10px; padding: 12px; box-sizing: border-box; margin: 10px 0; font-family: inherit; font-size: 14px; }
    
    .btn-order { background: #1a1a1a; color: white; width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 17px; font-weight: 700; cursor: pointer; transition: 0.3s; }
    .btn-order:disabled { background: #ccc; cursor: not-allowed; }
    .total-area { display: flex; justify-content: space-between; align-items: center; font-size: 19px; margin: 15px 0; }
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">ğŸ  NHÃ€ HÃ€NG DELI</div>
      <div style="background: #f1f1f1; padding: 5px 12px; border-radius: 20px; font-size: 14px;">BÃ n: <b id="displayTable">---</b></div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <h2>ğŸ´ Danh sÃ¡ch thá»±c Ä‘Æ¡n</h2>
    <div id="menuContent"></div>
  </div>

  <div class="card">
    <h2>ğŸ“‹ Xem trÆ°á»›c Ä‘Æ¡n hÃ ng</h2>
    <div id="cartPreview" class="preview-list">Báº¡n chÆ°a chá»n mÃ³n nÃ o...</div>
    
    <div class="total-area">
        <span>Tá»•ng cá»™ng:</span>
        <b id="totalPrice" style="color: var(--primary);">0â‚«</b>
    </div>

    <textarea id="orderNote" rows="2" placeholder="Ghi chÃº thÃªm: (vd: Ã­t hÃ nh, khÃ´ng cay, thÃªm Ä‘Ã¡...)"></textarea>
    
    <button id="submitBtn" class="btn-order" onclick="sendToTelegram()">XÃC NHáº¬N Äáº¶T MÃ“N</button>
  </div>
</main>

<script>
  // Cáº¤U HÃŒNH TOKEN VÃ€ ID Cá»¦A Báº N
  const TG_TOKEN = "8428955430:AAEvZ_8fM0yVbw7RiQ2XLuWcud3Bl48Hi48";
  const TG_CHAT_ID = "1533009941";

  const MENU = [
    { id: 1, name: "Phá»Ÿ BÃ² TÃ¡i", price: 45000 },
    { id: 2, name: "Phá»Ÿ GÃ  Ta", price: 45000 },
    { id: 3, name: "BÃºn BÃ² Huáº¿", price: 50000 },
    { id: 4, name: "CÃ  PhÃª Sá»¯a", price: 25000 },
    { id: 5, name: "NÆ°á»›c Cam Ã‰p", price: 30000 }
  ];

  let cart = {};
  const params = new URLSearchParams(location.search);
  const table = params.get("table") || "Mang vá»";
  document.getElementById("displayTable").innerText = table;

  // 1. Hiá»ƒn thá»‹ thá»±c Ä‘Æ¡n vá»›i nÃºt tÄƒng giáº£m sá»‘ lÆ°á»£ng
  function renderMenu() {
    document.getElementById("menuContent").innerHTML = MENU.map(item => {
      const qty = cart[item.id] || 0;
      return `
      <div class="item">
        <div>
          <span class="item-name">${item.name}</span>
          <span class="item-price">${item.price.toLocaleString()}â‚«</span>
        </div>
        <div class="qty-box">
          <button class="btn-qty" onclick="changeQty(${item.id}, -1)">-</button>
          <span class="qty-num">${qty}</span>
          <button class="btn-qty" onclick="changeQty(${item.id}, 1)">+</button>
        </div>
      </div>`;
    }).join("");
  }

  // 2. Thay Ä‘á»•i sá»‘ lÆ°á»£ng mÃ³n
  function changeQty(id, delta) {
    const currentQty = cart[id] || 0;
    const newQty = currentQty + delta;
    
    if (newQty > 0) {
      cart[id] = newQty;
    } else {
      delete cart[id]; // XÃ³a mÃ³n khi sá»‘ lÆ°á»£ng vá» 0
    }
    
    renderMenu();
    renderPreview();
  }

  // 3. Hiá»ƒn thá»‹ danh sÃ¡ch xem trÆ°á»›c
  function renderPreview() {
    const previewDiv = document.getElementById("cartPreview");
    const totalDisp = document.getElementById("totalPrice");
    let html = "";
    let total = 0;
    const entries = Object.entries(cart);

    if (entries.length === 0) {
      previewDiv.innerHTML = "Báº¡n chÆ°a chá»n mÃ³n nÃ o...";
      totalDisp.innerText = "0â‚«";
      return;
    }

    entries.forEach(([id, qty]) => {
      const item = MENU.find(m => m.id == id);
      const subtotal = item.price * qty;
      total += subtotal;
      html += `
        <div class="preview-item">
          <span><b>${item.name}</b> x${qty}</span>
          <span>${subtotal.toLocaleString()}â‚«</span>
        </div>`;
    });

    previewDiv.innerHTML = html;
    totalDisp.innerText = total.toLocaleString() + "â‚«";
  }

  // 4. Gá»­i Ä‘Æ¡n hÃ ng vá» Telegram
  async function sendToTelegram() {
    if (Object.keys(cart).length === 0) return alert("Giá» hÃ ng cá»§a báº¡n Ä‘ang trá»‘ng!");

    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.innerText = "VUI LÃ’NG Äá»¢I...";

    let text = `ğŸ”” <b>ÄÆ N HÃ€NG Má»šI</b>\n`;
    text += `ğŸ“ <b>BÃ n:</b> ${table}\n`;
    text += `â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    Object.entries(cart).forEach(([id, qty]) => {
      const item = MENU.find(m => m.id == id);
      text += `â€¢ ${item.name} x${qty} = ${(item.price * qty).toLocaleString()}â‚«\n`;
    });
    text += `â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    text += `ğŸ’° <b>Tá»•ng tiá»n: ${document.getElementById("totalPrice").innerText}</b>\n`;
    text += `ğŸ“ <b>Ghi chÃº:</b> ${document.getElementById("orderNote").value || "KhÃ´ng cÃ³"}`;

    try {
      const response = await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: TG_CHAT_ID, text: text, parse_mode: "HTML" })
      });

      const data = await response.json();
      if (data.ok) {
        alert("âœ… XÃC NHáº¬N: ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘i thÃ nh cÃ´ng!");
        cart = {}; 
        document.getElementById("orderNote").value = ""; 
        renderMenu(); 
        renderPreview();
      } else {
        alert("âŒ Lá»—i Telegram: " + data.description);
      }
    } catch (e) {
      alert("âŒ Lá»—i káº¿t ná»‘i: Vui lÃ²ng kiá»ƒm tra láº¡i máº¡ng!");
    } finally {
      btn.disabled = false;
      btn.innerText = "XÃC NHáº¬N Äáº¶T MÃ“N";
    }
  }

  // Khá»Ÿi táº¡o thá»±c Ä‘Æ¡n ban Ä‘áº§u
  renderMenu();
</script>
</body>
</html>
