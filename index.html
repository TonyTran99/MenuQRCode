<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Menu QR - Nh√† H√†ng C·ªßa B·∫°n</title>
  <style>
    :root { 
        --primary: #111;
        --bg: #f6f7fb;
        --border: #e8e8ee;
        --text-muted: #666;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
    }
    body { margin: 0; background: var(--bg); color: var(--primary); line-height: 1.5; }
    header { position: sticky; top:0; z-index:100; background:white; border-bottom:1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    .wrap { max-width: 900px; margin: 0 auto; padding: 12px; }
    .topbar { display:flex; gap:10px; align-items:center; justify-content:space-between; }
    .brand { font-weight: 800; font-size: 18px; letter-spacing: -0.5px; }
    .badge { background: var(--primary); color:#fff; padding:6px 14px; border-radius:999px; font-size:12px; font-weight: 600; }
    .tabs { display:flex; gap:8px; overflow-x:auto; padding:10px 12px; border-top:1px solid #f0f0f6; scrollbar-width: none; }
    .tabs::-webkit-scrollbar { display: none; }
    .tab { flex:0 0 auto; border:1px solid #e4e4ef; background:#fff; padding:8px 16px; border-radius:999px; font-size:13px; cursor:pointer; transition: all 0.2s; font-weight: 500; }
    .tab.active { background: var(--primary); color:#fff; border-color: var(--primary); }
    .grid { display:grid; grid-template-columns: 1fr; gap:16px; margin-top: 10px; }
    @media (min-width: 860px){ .grid { grid-template-columns: 1.8fr 1.2fr; align-items:start; } }
    .card { background:#fff; border:1px solid var(--border); border-radius:20px; overflow:hidden; }
    .card h2 { margin:0; padding:16px 16px 0; font-size:16px; font-weight: 700; }
    .card .sub { padding:4px 16px 16px; color: var(--text-muted); font-size:13px; }
    .section { padding: 0 16px 16px; }
    .cat { margin-top: 10px; }
    .cat-title { font-size:11px; color: var(--text-muted); text-transform:uppercase; letter-spacing:.08em; margin: 15px 0 10px; font-weight: 700; }
    .item { display:flex; gap:12px; padding:12px; border:1px solid var(--border); border-radius:16px; margin-bottom:12px; transition: transform 0.1s; }
    .item:active { transform: scale(0.98); }
    .thumb { width:70px; height:70px; border-radius:12px; background:#f2f2f8; flex:0 0 auto; overflow:hidden; display:flex; align-items:center; justify-content:center; font-size: 24px; }
    .thumb img { width:100%; height:100%; object-fit:cover; }
    .meta { flex:1 1 auto; min-width: 0; display:flex; flex-direction: column; justify-content: space-between; }
    .name { font-weight:600; font-size:15px; margin:0 0 2px; }
    .desc { margin:0; font-size:12px; color: var(--text-muted); }
    .row { display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
    .price { font-weight:700; font-size:15px; color: #d32f2f; }
    .qty { display:flex; align-items:center; gap:10px; }
    button { border:1px solid #e4e4ef; background:#fff; border-radius:10px; width: 32px; height: 32px; cursor:pointer; font-weight: bold; }
    button.primary { background: var(--primary); color:#fff; border-color: var(--primary); }
    button:disabled { opacity:.3; cursor:not-allowed; }
    .cart { position: sticky; top: 80px; }
    .cart-list { padding: 0 16px 10px; max-height: 40vh; overflow-y: auto; }
    .cart-item { display:flex; justify-content:space-between; gap:10px; padding:12px 0; border-bottom:1px dashed #eee; }
    .total { display:flex; justify-content:space-between; align-items:center; padding:16px; border-top:1px solid #f0f0f6; font-weight:800; font-size: 18px; }
    .note { width:100%; box-sizing:border-box; border:1px solid #e4e4ef; border-radius:12px; padding:12px; font-size:13px; resize: none; background: #f9f9fb; }
    .footer-actions{ display:flex; gap:10px; padding:16px; border-top:1px solid #f0f0f6; }
    .footer-actions button { flex:1; height: 44px; width: auto; }
    #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 99px; font-size: 14px; opacity: 0; transition: opacity 0.3s; z-index: 1000; pointer-events: none; }
  </style>
</head>
<body>

<div id="toast">ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i!</div>

<header>
  <div class="wrap">
    <div class="topbar">
      <div>
        <div class="brand">üçΩÔ∏è MENU QR PRO</div>
        <div style="color:var(--text-muted); font-size: 13px;">B√†n: <span id="tableId" style="font-weight:700; color:var(--primary)">---</span></div>
      </div>
      <div class="badge">üõí <span id="cartCount">0</span> m√≥n</div>
    </div>
  </div>
  <div class="tabs" id="tabs"></div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card">
      <h2>Th·ª±c ƒë∆°n</h2>
      <div class="sub">Vui l√≤ng ch·ªçn m√≥n ƒÉn y√™u th√≠ch</div>
      <div class="section" id="menuList"></div>
    </section>

    <aside class="card cart">
      <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
      <div class="section">
        <textarea class="note" id="note" rows="2" placeholder="Ghi ch√∫ th√™m (vd: kh√¥ng h√†nh, nhi·ªÅu cay...)"></textarea>
      </div>
      <div class="cart-list" id="cartList"></div>
      <div class="total">
        <span>T·ªïng</span>
        <span id="totalPrice" style="color:#d32f2f">0‚Ç´</span>
      </div>
      <div class="footer-actions">
        <button id="clearBtn">Xo√°</button>
        <button class="primary" id="submitBtn">ƒê·∫∑t m√≥n ngay</button>
      </div>
    </aside>
  </div>
</main>

<script>
  // C·∫§U H√åNH TELEGRAM C·ª¶A B·∫†N
  const TELEGRAM_TOKEN = "8535455523:AAH5HsUE3INTWKayf9JeHsS6h7g4c4TQsjE";
  const CHAT_ID = "1533009941";

  const MENU = [
    {id:"p1", page:1, category:"M√≥n Ph·ªü", name_vi:"Ph·ªü B√≤ T√°i", description_vi:"B√≤ t∆∞∆°i th√°i m·ªèng ngon ng·ªçt", price_vnd:45000, image_url:""},
    {id:"p2", page:1, category:"M√≥n Ph·ªü", name_vi:"Ph·ªü G√† Ta", description_vi:"G√† ƒëi b·ªô, th·ªãt ch·∫Øc gi√≤n", price_vnd:45000, image_url:""},
    {id:"d1", page:2, category:"ƒê·ªì U·ªëng", name_vi:"C√† Ph√™ ƒêen", description_vi:"C√† ph√™ rang xay nguy√™n ch·∫•t", price_vnd:20000, image_url:""},
    {id:"d2", page:2, category:"ƒê·ªì U·ªëng", name_vi:"Tr√† ƒê√°", description_vi:"M√°t l·∫°nh s·∫£ng kho√°i", price_vnd:5000, image_url:""}
  ];

  const fmtVND = n => (n||0).toLocaleString("vi-VN") + "‚Ç´";
  const qs = s => document.querySelector(s);
  const CART_KEY = "menu_qr_data";
  
  const params = new URLSearchParams(location.search);
  qs("#tableId").textContent = params.get("table") || "Mang v·ªÅ";

  let cart = JSON.parse(localStorage.getItem(CART_KEY) || "{}");
  let activePage = 1;

  function renderTabs(){
    const pages = [...new Set(MENU.map(m => m.page))].sort((a,b)=>a-b);
    const tabs = qs("#tabs");
    tabs.innerHTML = "";
    pages.forEach(p=>{
      const btn = document.createElement("button");
      btn.className = "tab" + (p===activePage ? " active":"");
      btn.textContent = "Nh√≥m " + p;
      btn.onclick = ()=>{ activePage = p; renderTabs(); renderMenu(); };
      tabs.appendChild(btn);
    });
  }

  function setQty(id, delta){
    cart[id] = (cart[id] || 0) + delta;
    if(cart[id] <= 0) delete cart[id];
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
    renderMenu();
    renderCart();
  }
  window.__setQty = setQty;

  function renderMenu(){
    const list = qs("#menuList");
    list.innerHTML = "";
    const items = MENU.filter(m=>m.page===activePage);
    const cats = [...new Set(items.map(m => m.category))];

    cats.forEach(cat => {
        list.innerHTML += `<div class="cat-title">${cat}</div>`;
        items.filter(m => m.category === cat).forEach(m => {
            const qty = cart[m.id] || 0;
            list.innerHTML += `
                <div class="item">
                    <div class="thumb">üç≤</div>
                    <div class="meta">
                        <div>
                            <div class="name">${m.name_vi}</div>
                            <div class="desc">${m.description_vi}</div>
                        </div>
                        <div class="row">
                            <div class="price">${fmtVND(m.price_vnd)}</div>
                            <div class="qty">
                                <button ${qty===0?'disabled':''} onclick="__setQty('${m.id}',-1)">-</button>
                                <span>${qty}</span>
                                <button class="primary" onclick="__setQty('${m.id}',1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>`;
        });
    });
    qs("#cartCount").textContent = Object.values(cart).reduce((a, b) => a + b, 0);
  }

  function renderCart(){
    const list = qs("#cartList");
    let total = 0;
    list.innerHTML = "";
    
    Object.entries(cart).forEach(([id, qty]) => {
        const item = MENU.find(m => m.id === id);
        if(!item) return;
        total += item.price_vnd * qty;
        list.innerHTML += `
            <div class="cart-item">
                <div><b>${item.name_vi}</b><br><small>${fmtVND(item.price_vnd)}</small></div>
                <div>x${qty}</div>
            </div>`;
    });
    qs("#totalPrice").textContent = fmtVND(total);
  }

  function showToast(msg) {
    const t = qs("#toast");
    t.textContent = msg; t.style.opacity = "1";
    setTimeout(() => t.style.opacity = "0", 3000);
  }

  qs("#submitBtn").onclick = async () => {
    if(Object.keys(cart).length === 0) return alert("B·∫°n ch∆∞a ch·ªçn m√≥n!");

    let text = `üîî <b>ƒê∆†N H√ÄNG M·ªöI</b>\nüìç <b>B√†n:</b> ${qs("#tableId").textContent}\n`;
    text += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
    Object.entries(cart).forEach(([id, qty]) => {
        const item = MENU.find(m => m.id === id);
        text += `‚Ä¢ ${item.name_vi} x${qty}\n`;
    });
    text += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
    text += `üí∞ <b>T·ªïng: ${qs("#totalPrice").textContent}</b>\n`;
    text += `üìù <b>Ghi ch√∫:</b> ${qs("#note").value || "Kh√¥ng"}`;

    try {
        const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ chat_id: CHAT_ID, text: text, parse_mode: "HTML" })
        });
        if(res.ok) {
            showToast("‚úÖ ƒê√£ ƒë·∫∑t m√≥n th√†nh c√¥ng!");
            cart = {}; localStorage.removeItem(CART_KEY);
            qs("#note").value = ""; renderMenu(); renderCart();
        } else { alert("L·ªói g·ª≠i ƒë∆°n!"); }
    } catch (e) { alert("L·ªói k·∫øt n·ªëi!"); }
  };

  qs("#clearBtn").onclick = () => { cart = {}; localStorage.removeItem(CART_KEY); renderMenu(); renderCart(); };

  renderTabs(); renderMenu(); renderCart();
</script>
</body>
</html>
